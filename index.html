<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard de Máquinas — Jornada 06:00–12:00</title>
<style>
  :root{
    font-size:16px;
    --bg:#f5f5f7;
    --panel:#fff;
    --panel-border:1px solid rgba(0,0,0,0.04);
    --panel-radius:22px;
    --shadow:0 22px 50px rgba(20,24,40,0.08);
    --text:#1d1d1f;
    --muted:#6e6e73;
    --line:rgba(209,209,214,0.8);
    --divider:1.5px solid rgba(209,209,214,0.8);
    --head-text:#6e6e73;
    --cell-text:#3a3a3c;
    --cond-text:#515154;
    --status-shadow:inset 0 -2px 6px rgba(0,0,0,0.12);
    --status-ok-bg:linear-gradient(135deg,rgba(52,199,89,0.65),rgba(88,224,118,0.95));
    --status-warn-bg:linear-gradient(135deg,rgba(255,204,0,0.7),rgba(255,214,40,0.95));
    --status-bad-bg:linear-gradient(135deg,rgba(255,59,48,0.78),rgba(255,105,97,0.95));
    --status-future-bg:repeating-linear-gradient(135deg,rgba(210,210,215,0.45) 0,rgba(210,210,215,0.45) 6px,rgba(255,255,255,0.7) 6px,rgba(255,255,255,0.7) 12px);
    --status-ok-border:rgba(52,199,89,0.45);
    --status-warn-border:rgba(255,204,0,0.55);
    --status-bad-border:rgba(255,59,48,0.5);
    --status-future-border:rgba(210,210,215,0.6);
    --chip-bad-bg:rgba(255,59,48,0.12);
    --chip-bad-border:rgba(255,59,48,0.35);
    --chip-bad-text:#a22022;
    --chip-warn-bg:rgba(255,204,0,0.16);
    --chip-warn-border:rgba(255,204,0,0.4);
    --chip-warn-text:#ad5f00;
    --pill-bg:#fff;
    --pill-border:1px solid rgba(209,209,214,0.8);
    --pill-shadow:0 6px 16px rgba(0,0,0,0.08);
    --now-bg:rgba(0,113,227,0.08);
    --now-outline:#0071e3;
    --time-gradient:linear-gradient(90deg,var(--panel) 75%,rgba(255,255,255,0));
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:"SF Pro Display","SF Pro Text",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
    background:var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
  }
  .wrap{max-width:min(1400px,98vw);margin-inline:auto;padding:42px 8px 72px;display:flex;flex-direction:column;gap:28px}
  header{display:flex;align-items:flex-start;justify-content:space-between;gap:20px}
  .title{display:flex;flex-direction:column;gap:6px}
  .title h1{margin:0;font-size:clamp(20px,2.6vw,30px);font-weight:650;letter-spacing:.2px;color:var(--text)}
  .subtitle{color:var(--muted);font-size:14px;line-height:1.6}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid rgba(0,0,0,0.06);border-radius:999px;background:#fff;color:var(--muted);font-size:12.5px}
  .dot{width:8px;height:8px;border-radius:999px;background:var(--muted);box-shadow:0 0 0 1px rgba(0,0,0,0.06) inset}
  .dot.ok{background:rgba(52,199,89,0.8)}
  .dot.warn{background:rgba(255,204,0,0.9)}
  .dot.bad{background:rgba(255,59,48,0.85)}
  .controls{display:flex;flex-wrap:wrap;gap:10px}
  .action-btn{appearance:none;border:1px solid rgba(0,0,0,0.06);background:var(--panel);color:var(--text);padding:10px 18px;border-radius:999px;font-weight:600;cursor:pointer;transition:.18s transform ease,.18s background ease,.18s border-color ease;box-shadow:0 10px 20px rgba(0,0,0,0.06)}
  .action-btn:hover{transform:translateY(-1px);border-color:rgba(0,0,0,0.12);background:rgba(255,255,255,0.85)}
  .action-btn.ghost{background:transparent}
  .panel{background:var(--panel);border:var(--panel-border);border-radius:var(--panel-radius);overflow:hidden;box-shadow:var(--shadow)}
  .tbl{width:100%;border-collapse:separate;border-spacing:0}
  thead th{position:sticky;top:0;z-index:3;background:var(--panel);color:var(--head-text);border-bottom:1px solid var(--line);padding:16px 14px;font-size:12.5px;text-transform:uppercase;letter-spacing:.08em;font-weight:600}
  thead th.machine-head{padding-inline:18px 16px}
  thead th.machine-head:not(:first-of-type){border-left:var(--divider)}
  thead .sub{font-size:12px;text-transform:none;letter-spacing:0;color:var(--muted);margin-top:2px;font-weight:500}
  tbody td{padding:16px 16px;border-bottom:1px solid var(--line);font-size:14.5px;color:var(--cell-text);vertical-align:top}
  tbody td.machine-divider{border-left:var(--divider)}
  tbody td.status-cell{text-align:center;width:90px}
  tbody tr:nth-child(odd){background:rgba(0,0,0,0.015)}
  tbody tr:hover{background:#f7f7fb}
  .time{position:sticky;left:0;background:var(--time-gradient);z-index:2;font-weight:600;color:var(--text);border-right:1px solid var(--line)}
  .status-swatch{display:inline-flex;width:60px;height:22px;border-radius:999px;box-shadow:var(--status-shadow)}
  .status-swatch.ok{background:var(--status-ok-bg);border:1px solid var(--status-ok-border)}
  .status-swatch.warn{background:var(--status-warn-bg);border:1px solid var(--status-warn-border)}
  .status-swatch.bad{background:var(--status-bad-bg);border:1px solid var(--status-bad-border)}
  .status-swatch.future{background:var(--status-future-bg);border:1px solid var(--status-future-border);box-shadow:none}
  .cond{color:var(--cond-text);line-height:1.5}
  .cond-tags{display:flex;flex-wrap:wrap;gap:6px}
  .cond-chip{display:inline-flex;align-items:center;justify-content:center;min-width:42px;padding:6px 12px;border-radius:14px;font-size:11.5px;font-weight:600;text-transform:none}
  .cond-chip.bad{background:var(--chip-bad-bg);border:1px solid var(--chip-bad-border);color:var(--chip-bad-text)}
  .cond-chip.warn{background:var(--chip-warn-bg);border:1px solid var(--chip-warn-border);color:var(--chip-warn-text)}
  .mini{display:flex;flex-wrap:wrap;gap:12px;align-items:center;color:var(--muted);font-size:12.5px;margin-top:20px}
  .pill{padding:.35rem .8rem;border-radius:999px;border:var(--pill-border);color:var(--text);background:var(--pill-bg);font-size:12.5px;box-shadow:var(--pill-shadow)}
  .now{box-shadow:inset 0 0 0 2px var(--now-outline);background:var(--now-bg)!important}
  @media (max-width: 900px){
    header{flex-direction:column}
    .controls{width:100%}
    .controls .action-btn{flex:1;justify-content:center;text-align:center}
    thead .hide-sm, tbody .hide-sm{display:none}
    .subtitle{max-width:500px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Dashboard de Operación — 4 Máquinas</h1>
        <div class="subtitle">
          Jornada: <strong>06:00</strong> a <strong>12:00</strong> · Intervalo cada <strong>15 min</strong>
          <div class="chips">
            <span class="chip"><span class="dot ok"></span> Estado positivo</span>
            <span class="chip"><span class="dot warn"></span> Aviso</span>
            <span class="chip"><span class="dot bad"></span> Estado negativo</span>
          </div>
        </div>
      </div>
      <div class="controls">
        <button id="scrollNow" class="action-btn ghost">Ir al bloque horario actual</button>
      </div>
    </header>

    <div class="panel">
      <table class="tbl" id="grid">
        <thead id="thead"></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div class="mini">
      <span class="pill" id="summary-ok">OK: —</span>
      <span class="pill" id="summary-warn">Avisos: —</span>
      <span class="pill" id="summary-bad">Fallas: —</span>
      <span class="pill" id="summary-rate">Disponibilidad: —</span>
    </div>
  </div>

<script>
(()=>{
  const machines = [
    {name:"Máquina A"},
    {name:"Máquina B"},
    {name:"Máquina C"},
    {name:"Máquina D"}
  ];

  const FIELDS = [
    "Gafete operador escaneado",
    "Gafete de técnico escaneado",
    "Carrete escaneado",
    "Hoja de ruta escaneada",
    "Cabezal en operación",
    "Carrete en consumo"
  ];

  const CRITICAL = new Set([
    "Carrete escaneado",
    "Cabezal en operación",
    "Carrete en consumo"
  ]);

  const STATUS_LABELS = {
    ok:"Estado óptimo",
    warn:"Aviso de seguimiento",
    bad:"Falla detectada",
    future:"Pendiente de registrar"
  };

  const stepMinutes = 15;
  const start = "06:00";
  const end = "12:00";

  function toMinutes(hhmm){
    const [h,m] = hhmm.split(":").map(Number);
    return h*60 + m;
  }

  function pad(num){
    return String(num).padStart(2,"0");
  }

  function buildSlots(start,end,step){
    const slots = [];
    let cursor = toMinutes(start);
    const endMinutes = toMinutes(end);
    while(cursor <= endMinutes){
      const h = Math.floor(cursor/60);
      const m = cursor % 60;
      slots.push(`${pad(h)}:${pad(m)}`);
      cursor += step;
    }
    return slots;
  }

  function crearRegistroTF(){
    const registro = {};
    registro[FIELDS[0]] = Math.random() < 0.96;
    registro[FIELDS[1]] = Math.random() < 0.94;
    registro[FIELDS[2]] = Math.random() < 0.93;
    registro[FIELDS[3]] = Math.random() < 0.91;
    registro[FIELDS[4]] = Math.random() < 0.82;
    registro[FIELDS[5]] = registro[FIELDS[4]] ? Math.random() < 0.93 : Math.random() < 0.1;
    return registro;
  }

  function evaluarRegistro(registro){
    const errores = [];
    const avisos = [];

    for(const campo of FIELDS){
      if(!registro[campo]){
        if(CRITICAL.has(campo)) errores.push(campo);
        else avisos.push(campo);
      }
    }

    if(errores.length===0 && avisos.length===0){
      return {class:"ok", errores, avisos};
    }
    if(errores.length>0){
      return {class:"bad", errores, avisos};
    }
    return {class:"warn", errores, avisos};
  }

  function renderHead(){
    const thead = document.getElementById("thead");
    const tr1 = document.createElement("tr");
    tr1.innerHTML = `
      <th style="left:0;z-index:4" class="time">Horario</th>
      ${machines.map(m=>`<th class="machine-head" colspan="2">${m.name}<div class="sub">Status · Condición</div></th>`).join("")}
    `;
    thead.innerHTML = "";
    thead.appendChild(tr1);
  }

  function generateData(){
    const slots = buildSlots(start,end,stepMinutes);

    let cOK=0, cWARN=0, cBAD=0;

    const tbody = document.getElementById("tbody");
    tbody.innerHTML = "";

    const now = new Date();
    const currentMinutes = now.getHours()*60 + now.getMinutes();

    for(const hhmm of slots){
      const tr = document.createElement("tr");

      const tdTime = document.createElement("td");
      tdTime.textContent = hhmm;
      tdTime.className = "time";
      tr.appendChild(tdTime);

      const rowMins = toMinutes(hhmm);
      const isFuture = rowMins > currentMinutes;

      machines.forEach((_, idx)=> {
        const tdStatus = document.createElement("td");
        tdStatus.className = "status-cell";
        const tdCond = document.createElement("td");
        tdCond.className = "cond";

        if(idx>0){
          tdStatus.classList.add("machine-divider");
        }

        if(isFuture){
          tdStatus.innerHTML = `<span class="status-swatch future" title="${STATUS_LABELS.future}" aria-label="${STATUS_LABELS.future}"></span>`;
          tdCond.textContent = "";
        } else {
          const registro = crearRegistroTF();
          const ev = evaluarRegistro(registro);
          tdStatus.innerHTML = `<span class="status-swatch ${ev.class}" title="${STATUS_LABELS[ev.class]}" aria-label="${STATUS_LABELS[ev.class]}"></span>`;

          if(ev.class === "ok"){
            tdCond.textContent = "";
            cOK++;
          } else {
            const chips = [
              ...ev.errores.map(field => `<span class="cond-chip bad">${field}</span>`),
              ...ev.avisos.map(field => `<span class="cond-chip warn">${field}</span>`)
            ].join("");
            tdCond.innerHTML = `<div class="cond-tags">${chips}</div>`;
            if(ev.class === "warn") cWARN++; else cBAD++;
          }
        }

        tr.appendChild(tdStatus);
        tr.appendChild(tdCond);
      });

      if (rowMins <= currentMinutes && currentMinutes < rowMins + stepMinutes){
        tr.classList.add("now");
        tr.id = "nowRow";
      }

      tbody.appendChild(tr);
    }

    const total = cOK + cWARN + cBAD;
    const disponibilidad = total ? Math.round((cOK/total)*100) : 0;
    document.getElementById("summary-ok").textContent   = `OK: ${cOK}`;
    document.getElementById("summary-warn").textContent = `Avisos: ${cWARN}`;
    document.getElementById("summary-bad").textContent  = `Fallas: ${cBAD}`;
    document.getElementById("summary-rate").textContent = `Disponibilidad: ${disponibilidad}%`;
  }

  function scrollToNow(){
    const el = document.getElementById("nowRow");
    if(!el){ window.scrollTo({top:0,behavior:"smooth"}); return; }
    const top = el.getBoundingClientRect().top + window.scrollY - 90;
    window.scrollTo({top, behavior:"smooth"});
  }

  renderHead();
  generateData();
  document.getElementById("scrollNow").addEventListener("click", scrollToNow);
})();
</script>
</body>
</html>
