<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard de Máquinas — Jornada 06:00–12:00</title>
<style>
  :root{
    --bg:#f5f5f7;
    --panel:#fff;
    --muted:#6e6e73;
    --text:#1d1d1f;
    --ok:#34c759;
    --bad:#ff3b30;
    --warn:#ff9f0a;
    --line:#d2d2d7;
    --chip-bg:#f5f5f7;
    --chip-br:#e5e5ea;
    --accent:#0071e3;
    --shadow:0 18px 44px rgba(0,0,0,0.08);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:"SF Pro Display","SF Pro Text",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
    background:var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
  }
  .wrap{max-width:min(1360px,98vw);margin-inline:auto;padding:40px 12px 64px}
  header{display:flex;align-items:flex-start;justify-content:space-between;gap:20px;margin-bottom:28px}
  .title{display:flex;flex-direction:column;gap:6px}
  .title h1{margin:0;font-size:clamp(20px,2.6vw,28px);font-weight:650;letter-spacing:.2px}
  .subtitle{color:var(--muted);font-size:14px;line-height:1.6}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--chip-br);border-radius:999px;background:var(--chip-bg);color:var(--muted);font-size:12.5px}
  .dot{width:8px;height:8px;border-radius:999px;background:var(--muted);box-shadow:0 0 0 1px rgba(0,0,0,0.06) inset}
  .dot.ok{background:var(--ok)}
  .dot.bad{background:var(--bad)}
  .dot.warn{background:var(--warn)}
  .controls{display:flex;flex-wrap:wrap;gap:10px}
  button,.ghost{appearance:none;border:1px solid var(--chip-br);background:#fff;color:var(--text);padding:10px 16px;border-radius:999px;font-weight:600;cursor:pointer;transition:.18s transform ease,.18s background ease,.18s border-color ease;box-shadow:0 6px 12px rgba(0,0,0,0.04)}
  button:hover{transform:translateY(-1px);border-color:#c7c7cc;background:#f2f2f7}
  .ghost{background:var(--bg)}
  .panel{background:var(--panel);border:1px solid #e5e5ea;border-radius:22px;overflow:hidden;box-shadow:var(--shadow)}
  /* Tabla */
  .tbl{width:100%;border-collapse:separate;border-spacing:0}
  thead th{
    position:sticky;top:0;z-index:3;background:#fff;
    color:var(--muted);border-bottom:1px solid var(--line);padding:16px 14px;font-size:12.5px;
    text-transform:uppercase;letter-spacing:.08em;font-weight:600;
  }
  thead th.machine-head{padding-inline:18px 16px}
  thead th.machine-head:not(:first-of-type){border-left:1.5px solid rgba(210,210,215,0.8)}
  thead .sub{font-size:12px;text-transform:none;letter-spacing:0;color:var(--muted);margin-top:2px;font-weight:500}
  tbody td{padding:16px 16px;border-bottom:1px solid rgba(210,210,215,0.55);font-size:14.5px;color:#3a3a3c;vertical-align:top}
  tbody td.machine-divider{border-left:1.5px solid rgba(210,210,215,0.8)}
  tbody td.status-cell{text-align:center;width:90px}
  tbody tr:nth-child(odd){background:rgba(0,0,0,0.01)}
  tbody tr:hover{background:#f7f7fb}
  .time{
    position:sticky;left:0;background:linear-gradient(90deg,#fff 75%,rgba(255,255,255,0));
    z-index:2;font-weight:600;color:var(--text);border-right:1px solid var(--line)
  }
  .status-swatch{
    display:inline-flex;width:64px;height:22px;border-radius:999px;box-shadow:inset 0 -2px 6px rgba(0,0,0,0.12);
    background:var(--chip-bg);border:1px solid rgba(210,210,215,0.7);
  }
  .status-swatch.ok{background:linear-gradient(135deg,rgba(52,199,89,0.65),rgba(88,224,118,0.95));border-color:rgba(52,199,89,0.45)}
  .status-swatch.warn{background:linear-gradient(135deg,rgba(255,204,0,0.65),rgba(255,214,40,0.95));border-color:rgba(255,204,0,0.5)}
  .status-swatch.bad{background:linear-gradient(135deg,rgba(255,59,48,0.75),rgba(255,105,97,0.95));border-color:rgba(255,59,48,0.5)}
  .status-swatch.future{background:repeating-linear-gradient(135deg,rgba(210,210,215,0.4) 0,rgba(210,210,215,0.4) 6px,rgba(255,255,255,0.6) 6px,rgba(255,255,255,0.6) 12px);border-color:rgba(210,210,215,0.6);box-shadow:none}
  .cond{color:#515154;line-height:1.5}
  .cond-tags{display:flex;flex-wrap:wrap;gap:6px}
  .cond-chip{
    display:inline-flex;align-items:center;justify-content:center;min-width:42px;padding:6px 12px;border-radius:14px;
    font-size:11.5px;font-weight:600;letter-spacing:.06em;text-transform:uppercase;
  }
  .cond-chip.bad{background:rgba(255,59,48,0.14);border:1px solid rgba(255,59,48,0.35);color:#a22022}
  .cond-chip.warn{background:rgba(255,204,0,0.14);border:1px solid rgba(255,204,0,0.35);color:#ad5f00}
  .mini{display:flex;gap:12px;align-items:center;color:var(--muted);font-size:12.5px;margin-top:20px}
  .pill{padding:.35rem .8rem;border-radius:999px;border:1px solid var(--chip-br);color:var(--text);background:#fff;font-size:12.5px;box-shadow:0 6px 12px rgba(0,0,0,0.05)}
  .now{box-shadow:inset 0 0 0 2px var(--accent);background:rgba(0,113,227,0.08)!important}
  @media (max-width: 900px){
    thead .hide-sm, tbody .hide-sm{display:none}
    .subtitle{max-width:500px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Dashboard de Operación — 4 Máquinas</h1>
        <div class="subtitle">
          Jornada: <strong>06:00</strong> a <strong>12:00</strong> · Intervalo cada <strong>15 min</strong>
          <div class="chips">
            <span class="chip"><span class="dot ok"></span> Estado positivo</span>
            <span class="chip"><span class="dot warn"></span> Aviso</span>
            <span class="chip"><span class="dot bad"></span> Estado negativo</span>
          </div>
        </div>
      </div>
      <div class="controls">
        <button id="regen">Generar nuevos datos</button>
        <button id="scrollNow" class="ghost">Ir al bloque horario actual</button>
      </div>
    </header>

    <div class="panel">
      <table class="tbl" id="grid">
        <thead id="thead"></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div class="mini" style="margin-top:12px">
      <span class="pill" id="summary-ok">OK: —</span>
      <span class="pill" id="summary-warn">Avisos: —</span>
      <span class="pill" id="summary-bad">Fallas: —</span>
      <span class="pill" id="summary-rate">Disponibilidad: —</span>
    </div>
  </div>

<script>
(function(){
  // ----- Configuración -----
  const machines = [
    { name: "Máquina 1" },
    { name: "Máquina 2" },
    { name: "Máquina 3" },
    { name: "Máquina 4" },
  ];

  // Condiciones base (en el mismo orden que tu hoja)
  const FIELDS = [
    "Gafete operador escaneado",
    "Gafete de técnico escaneado",
    "Carrete escaneado",
    "Hoja de ruta escaneada",
    "Cabezal en operación",
    "Carrete en consumo",
  ];

  const FIELD_TAG = {
    "Gafete operador escaneado": "OP",
    "Gafete de técnico escaneado": "TEC",
    "Carrete escaneado": "CAR",
    "Hoja de ruta escaneada": "RUTA",
    "Cabezal en operación": "HEAD",
    "Carrete en consumo": "MAT",
  };

  const FIELD_TAG = {
    "Gafete operador escaneado": "OP",
    "Gafete de técnico escaneado": "TEC",
    "Carrete escaneado": "CAR",
    "Hoja de ruta escaneada": "RUTA",
    "Cabezal en operación": "HEAD",
    "Carrete en consumo": "MAT",
  };

  // Qué se considera crítico para caer en ROJO si está en false
  const CRITICAL = new Set([
    "Carrete escaneado",
    "Cabezal en operación",
    "Carrete en consumo",
  ]);

  const start = "06:00";
  const end   = "12:00";
  const stepMinutes = 15;

  // Probabilidades base (afinables)
  const P = {
    badgeOperador: 0.96,
    badgeTecnico : 0.94,
    carreteScan  : 0.93,
    hojaRuta     : 0.91,
    operacion    : 0.82,
    consumoSiOperando: 0.93, // si opera, prob de consumo true
    consumoSiNoOpera : 0.10, // si no opera, casi siempre false
  };

  // ----- Utilidades -----
  const toMinutes = (hhmm)=> {
    const [h,m] = hhmm.split(":").map(Number);
    return h*60+m;
  };
  const pad = (n)=> (n<10?"0":"")+n;
  const fmt = (mins)=> `${pad(Math.floor(mins/60))}:${pad(mins%60)}`;
  const buildSlots = (a,b,step)=>{const out=[],A=toMinutes(a),B=toMinutes(b);for(let t=A;t<=B;t+=step) out.push(fmt(t));return out;};
  const chance = (p)=> Math.random()<p;

  // Registra un diccionario de T/F por campo con correlaciones realistas
  function crearRegistroTF(){
    const tf = {};
    tf[FIELDS[0]] = chance(P.badgeOperador);
    tf[FIELDS[1]] = chance(P.badgeTecnico);
    tf[FIELDS[2]] = chance(P.carreteScan);
    tf[FIELDS[3]] = chance(P.hojaRuta);
    tf[FIELDS[4]] = chance(P.operacion);
    // Consumo depende de si está operando
    tf[FIELDS[5]] = tf[FIELDS[4]] ? chance(P.consumoSiOperando) : chance(P.consumoSiNoOpera);
    return tf;
  }

  const STATUS_LABELS = { ok: "Activo", warn: "Aviso", bad: "Falla", future: "Pendiente" };

  // Evalúa: color y colecciones de incidencias
  function evaluarRegistro(tf){
    const errores = [];
    const avisos = [];
    for(const k of FIELDS){
      if(!tf[k]){
        if(CRITICAL.has(k)) errores.push(k);
        else avisos.push(k);
      }
    }
    if(errores.length===0 && avisos.length===0){
      return {class:"ok", errores, avisos};
    }
    if(errores.length>0){
      return {class:"bad", errores, avisos};
    }
    return {class:"warn", errores, avisos};
  }

  // ----- Render de cabecera -----
  function renderHead(){
    const thead = document.getElementById("thead");
    const tr1 = document.createElement("tr");
    tr1.innerHTML = `
      <th style="left:0;z-index:4" class="time">Horario</th>
      ${machines.map(m=>`<th class="machine-head" colspan="2">${m.name}<div class="sub">Status · Condición (según reglas)</div></th>`).join("")}
    `;
    thead.innerHTML = "";
    thead.appendChild(tr1);
  }

  // ----- Generación y render de datos -----
  function generateData(){
    const slots = buildSlots(start,end,stepMinutes);

    let cOK=0, cWARN=0, cBAD=0;

    const tbody = document.getElementById("tbody");
    tbody.innerHTML = "";

    const now = new Date();
    const currentMinutes = now.getHours()*60 + now.getMinutes();

    for(const hhmm of slots){
      const tr = document.createElement("tr");

      // Columna horario
      const tdTime = document.createElement("td");
      tdTime.textContent = hhmm;
      tdTime.className = "time";
      tr.appendChild(tdTime);

      const rowMins = toMinutes(hhmm);
      const isFuture = rowMins > currentMinutes;

      // Por cada máquina: evaluar condiciones -> estado + detalle
      machines.forEach((_, idx)=> {
        const tdStatus = document.createElement("td");
        tdStatus.className = "status-cell";
        const tdCond = document.createElement("td");
        tdCond.className = "cond";

        if(idx>0){
          tdStatus.classList.add("machine-divider");
        }

        if(isFuture){
          tdStatus.innerHTML = `<span class="status-swatch future" title="${STATUS_LABELS.future}" aria-label="${STATUS_LABELS.future}"></span>`;
          tdCond.textContent = "";
        } else {
          const tf = crearRegistroTF();
          const ev = evaluarRegistro(tf);
          tdStatus.innerHTML = `<span class="status-swatch ${ev.class}" title="${STATUS_LABELS[ev.class]}" aria-label="${STATUS_LABELS[ev.class]}"></span>`;

          if(ev.class === "ok"){
            tdCond.textContent = "";
            cOK++;
          } else {
            const chips = [
              ...ev.errores.map(field => `<span class="cond-chip bad">${FIELD_TAG[field]||field}</span>`),
              ...ev.avisos.map(field => `<span class="cond-chip warn">${FIELD_TAG[field]||field}</span>`)
            ].join("");
            tdCond.innerHTML = `<div class="cond-tags">${chips}</div>`;
            if(ev.class === "warn") cWARN++; else cBAD++;
          }
        }

        tr.appendChild(tdStatus);
        tr.appendChild(tdCond);
      });

      // Resalta el bloque horario actual si cae dentro del intervalo
      if (rowMins <= currentMinutes && currentMinutes < rowMins + stepMinutes){
        tr.classList.add("now");
        tr.id = "nowRow";
      }

      tbody.appendChild(tr);
    }

    // Resumen
    const total = cOK + cWARN + cBAD;
    const disponibilidad = total ? Math.round((cOK/total)*100) : 0;
    document.getElementById("summary-ok").textContent   = `OK: ${cOK}`;
    document.getElementById("summary-warn").textContent = `Avisos: ${cWARN}`;
    document.getElementById("summary-bad").textContent  = `Fallas: ${cBAD}`;
    document.getElementById("summary-rate").textContent = `Disponibilidad: ${disponibilidad}%`;
  }

  // ----- Acciones -----
  function scrollToNow(){
    const el = document.getElementById("nowRow");
    if(!el){ window.scrollTo({top:0,behavior:"smooth"}); return; }
    const top = el.getBoundingClientRect().top + window.scrollY - 90;
    window.scrollTo({top, behavior:"smooth"});
    el.animate([{outlineColor:"transparent"}, {outlineColor:"var(--accent)"}], {duration:600,iterations:1});
  }

  // Init
  renderHead();
  generateData();
  document.getElementById("regen").addEventListener("click", generateData);
  document.getElementById("scrollNow").addEventListener("click", scrollToNow);
})();
</script>
</body>
</html>
